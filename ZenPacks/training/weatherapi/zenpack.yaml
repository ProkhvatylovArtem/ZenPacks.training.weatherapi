name: ZenPacks.training.weatherapi

zProperties:
  DEFAULTS:
    category: rapidapi weather

  zWeatherAPIHost:
    type: string
    default: 'weatherapi-com.p.rapidapi.com'

  zWeatherAPIKey:
    type: string
    default: '4767ff11ccmsh07e3f8226920ec0p1fb674jsn4711e7bb5020'

  zWeatherAPICities:
    type: lines
    default:
      - Lviv
      - Kiev
      - Kirovohrad

classes:
  WeatherAPIDevice:
    base: [ zenpacklib.Device ]
    label: rapidapi weather API

  WeatherAPILocation:
    base: [ zenpacklib.Component ]
    label: Location

    properties:
      country:
        label: Country

      tz_id:
        label: Timezone

      lat:
        label: Latitude

      lon:
        label: Longitude

      temp_c:
        label: Temperature ะก
        datapoint: conditions_temp_c

      humidity:
        label: Humidity
        datapoint: conditions_humidity

      wind_kph:
        label: Wind kph
        datapoint: conditions_wind_kph

      pressure_mb:
        label: Pressure mb
        datapoint: conditions_pressure_mb

    monitoring_templates: [Location]

class_relationships:
  - WeatherAPIDevice 1:MC WeatherAPILocation

device_classes:
  /weatherapi:
    zProperties:
      zPythonClass: ZenPacks.training.weatherapi.WeatherAPIDevice
      zPingMonitorIgnore: true
      zSnmpMonitorIgnore: true
      zCollectorPlugins:
        - weatherapi.Locations

    templates:
      Location:
        description: Weather monitoring using the rapidapi.weather API.
        targetPythonClass: ZenPacks.training.weatherapi.WeatherAPILocation

        datasources:

          conditions:
            type: Python
            plugin_classname: ZenPacks.training.weatherapi.dsplugins.Conditions
            cycletime: "1800"

            datapoints:
              temp_c: GAUGE
              feelslike_c: GAUGE
              temp_f: GAUGE
              feelslike_f: GAUGE
              wind_kph: GAUGE
              wind_mph: GAUGE
              humidity: GAUGE
              pressure_mb: GAUGE
              pressure_in: GAUGE

        thresholds:
          WindWarning:
            dsnames: [conditions_wind_kph]
            eventClass: /Status
            severity: Warning
            minval: 0
            maxval: 30

        graphs:
          Temperature C:
            units: "degrees C."
            graphpoints:
              RealTemperature:
                dpName: conditions_temp_c
                format: "%7.2lf"

              FeelsLikeTemperature:
                dpName: conditions_feelslike_c
                format: "%7.2lf"

          Temperature F:
            units: "degrees F."
            graphpoints:
              RealTemperature:
                dpName: conditions_temp_f
                format: "%7.2lf"
              FeelsLikeTemperature:
                dpName: conditions_feelslike_f
                format: "%7.2lf"

          Wind kph:
            units: "kph"
            graphpoints:
              Wind:
                dpName: conditions_wind_kph
                format: "%7.2lf"

          Wind mph:
            units: "mph"
            graphpoints:
              Wind:
                dpName: conditions_wind_mph
                format: "%7.2lf"

          Humidity:
            units: "percent"
            graphpoints:
              Humidity:
                dpName: conditions_humidity
                format: "%7.2lf"

          Pressure mb:
            units: "mbar"
            graphpoints:
              Humidity:
                dpName: conditions_pressure_mb
                format: "%7.2lf"

          Pressure in:
            units: "inches of mercury"
            graphpoints:
              Humidity:
                dpName: conditions_pressure_in
                format: "%7.2lf"

          Thresholds:
            units:
            graphpoints:
              WindWarning:
                type: WindWarningGraphPoint
                threshid: WindWarning
